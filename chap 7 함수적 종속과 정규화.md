# chap 7 : 함수적 종속과 정규화

## **01. 함수적 종속**

### ****1-1 함수적 종속의 정의****

- 논리적 설계단계에서 데이터 중복이 발생할 때
    - 테이블을 분해함으로써 달성 가능
- ***함수적 종속  functional dependency*** - 중복을 해결하기 위한 수단
    - 무결성 제약의 한 종류
    - 테이블 내에 필드 간의 관계성을 표현
    - ***데이터 중복의 발생 여부를 파악하는데 사용***
- 기본 정의
    - 테이블 R에서 필드 X의 값이 동일한 임의의 레코드에 대해 필드 Y의 값도 동일하다면 ***“Y는 X에 함수적 종속된다”***
    - X : 결정자 determinant / Y : 종속자 dependent
    - X → Y
    - ***Y는 X에 함수적 종속된다 = X는 Y를 함수적으로 결정한다***
- 함수 종속의 관계 p304
    - 다대일
    - 일대일
- 필드 집합 간의 함수 종속 p305
    - 결정자와 종속자가 두 개 이상의 필드로 구성 가능
- 결정자는 후보키 또는 기본키라는 것을 알 수 있음

### ****1-2 함수적 종속의 특성****

- ***포함 규칙***
    - 테이블 R의 필드 집합 X, Y에 대해 X ⊃ Y이면 X → Y가 항상 성립
- ***분해 규칙 (종속자 분해)***
    - 테이블 R의 필드 집합 X, Y, Z에 대해 X → (Y, Z)이면 X → Y, X → Z가 각각 항상 성립한다.
    - 결정자는 분해 X, 종속자만 분해 가능
- ***합성 규칙 (종속자 결합)***
    - 테이블 R의 필드 집합 X, Y, Z에 대해 X → Y, X → Z가 성립하면 X → (Y, Z)도 성립한다.
- ***이행 규칙***
    - 테이블 R의 필드 집합 X, Y, Z에 대해 X → Y, Y → Z가 성립하면 X → Z도성립한다.
    - 이러한 함수적 종속을 ***이행적(transitive) 함수적 종속***이라고 하며, Z는 X에 이행 종속된다 라고 한다.

### ****1-3 키와 함수적 종속의 관계****

- 테이블의 모든 필드는 키(수퍼키 포함)에 함수적으로 종속된다.
- 테이블의 필드 X가 나머지 필드들을 함수적으로 결정하면 필드 X는 수퍼키이다.
- ***정의***
    - ***테이블 R에서 필드 K가 수퍼키이면, K → R이 성립한다. 여기서 R은 테이블 R에 포함된 모든 필드들의 집합을 의미한다.***
- 단, 중복된 레코드가 없다는 관계형 데이터 모델의 규칙을 따라야 한다.

### ****1-4 함수적 종속의 유지 방법****

- 함수적 종속은 무결성 제약의 일종
- 어떠한 테이블 인스턴스에 대해서도 주어진 함수적 종속을 항상 만족하도록 유지해야 한다.
- RDBMS에서의 함수적 종속 유지방법
    - 기본키의 경우 함수적 종속이 계속 유지될 수 있음
    - 기본키가 아닌 필드에 대해서는 함수적 종속 유지가 어려움
- 해결방법
    - 데이터베이스를 설계할 때 이러한 문제가 발생하지 않도록 테이블들을 정의
    - 이러한 과정을 ***정규화 normalization***

## 02 **정규화**

- 불필요한 데이터의 중복을 피하기 위해 스키마를 ***분해 (decomposition)***하는 과정
- 함수적 종속이 중요한 역할을 함

### ****2-1 데이터 중복의 문제점****

- ***이상현상 anomaly***
    - 데이터가 중복 저장되는 경우 데이터 변경 (삽입, 삭제, 수정)에 의해 원하지 않던 결과가 발생할 수 있음
- 이상현상의 종류
    - 삽입이상
    - 삭제이상
    - 수정이상
- ***삽입 이상 insertion anomaly***
    - 어떠한 데이터를 저장하려고 할 때 저장할 수 없거나 원하지 않는 데이터를 삽입 해야만 하는 현상
- ***삭제 이상 deletion anomaly***
    - 하나의 사실을 삭제할 경우 삭제되지 말아야 할 정보까지 동시에 삭제되는 현상
- ***수정 이상 update anomaly***
    - 중복된 정보의 일부만을 수정하여 정보의 불일치 (inconsistency)가 발생하는 현상
- 해결 방안
    - 별도의 테이블로 구성

### ****2-2 정규형****

- 정규화 normalization란?
    - 불필요한 데이터 중복을 피하기 위해 스키마를 분해 decomposition
- 정규화의 효과
    - 테이블에 대한 삽입, 삭제, 수정 등의 연산으로 인해 발생할 수 있는 이상현상을 방지하는 수단을 제공
    - 데이터 중복으로 발생하는 문제 해결
    - 단, 함수적 종속이 유지될 수 있도록 데이터베이스 설계해야 함
- ***정규형 normal form***
    - 각 단계별 정규화 과정을 통해 분해된 테이블들
- 정규형의 종류
    - 1차 정규형 1NF : first normal form
    - 2NF
    - 3NF
    - ***보이스-코드 정규형 BCNF : Boyce-Codd normal form***
    - 4NF
    - 5NF
        - 5차로 갈수록 강하게 (세부적으로 쪼갬) 정규화
- 1차 정규형 p314
    - 정의
        - 테이블 R에 속한 ***모든 도메인이 원자값(atomic value)만으로 구성***되어 있다면 R은 1차 정규형이다.
    - 관계형 데이터 모델의 정의를 따르는 모든 테이블은 1차 정규형
- 1차 정규형의 문제점 p315
    - 삽입 이상, 삭제 이상, 수정 이상
    - 문제 발생 원인
        - ***부분 종속 partial dependency***
            - 키에 포함되지 않은 필드가 키의 부분집합에 종속되는 것
- 2차 정규형 p317
    - 부분 종속의 제거
        - 부분 종속에 해당하는 결정자와 종속자를 별도의 테이블로 분리하여 해결
        - 분해된 테이블은 함수적 종속이 그대로 보존된다.
    - 정의
        - 테이블 R에서 키가 아닌 모든 필드가 키에 함수적으로 종속되며, 키의 부분집합이 결정자가 되는 ***부분 종속이 존재하지 않으면***  R은 2차 정규형이다.
        - 하나의 필드로 키가 되는 경우 모두 2차 정규형에 해당
- 테이블 분해 조건 p318~320
    - ***종속성 보존 분해 dependency-preserving decomposition***
        - 분해되기 전의 함수적 종속들이 분해 후에도 유지되어야 한다.
    - ***무손실 조인 분해 lossless-join decomposition***
        - 일반적으로 테이블 R이 R1, R2로 분해되었을 때 R1 ⋈ R2 ⊇ R 이 항상 성립
            - 즉, 분해된 테이블들을 자연 조인하면 원래의 테이블과 일치되어야 함
        - 무손실 분해 조건
            - 즉, 분해된 테이블의 공통 필드 집합이 둘 중 하나의 테이블에서 키가 된다면 무손실 조인 분해가 된다.
        - 손실 조인 분해 lossy-join decomposition
            - 추가적으로 없던 레코드가 포함될 수 있음을 의미
            - 본래 테이블에 존재하지 않는 레코드가 생성된 경우
- 2차 정규형의 문제점 p320
    - 삽입 이상, 삭제 이상, 수정 이상
    - 문제 발생 원인
        - ***기본키의 이행 종속***
    - 해결 방안
        - 이행 종속에 참여한 필드들을 다른 테이블로 분해하여 해결 -> 종속성 보존과 무손실 분해가 모두 만족
- 3차 정규형 p321~322
    - 정의
        - 테이블 R이 2차 정규형이면서 키에 속하지 않은 ***모든 필드가 기본키에 이행 종속되지 않는다면*** R은 3차 정규형이다.
- 3차 정규형의 문제점
    - 부분 종속 및 이행 종속이 존재 하지 않는다
    - 하지만 특수한 경우에 삽입 이상, 삭제 이상, 수정 이상 발생 가능
    - 문제 발생의 원인
        - 키에 포함되는 필드 집합 A와 키에 포함되지 않은 필드 집합 X에 대하여 X → A라는 함수적 종속이 존재할 경우 데이터 중복 발생
- ***보이스-코드 정규형***
    - 정의
        - 테이블 R에 존재하는 ***모든 함수적 종속에서 결정자가 후보키이면***  R은 보이스-코드 정규형이다.
        - 3차 정규형보다 강한 제약이 가해진 정규형
- 보이스-코드 정규형의 문제점
    - 종속성 보존 분해가 항상 보장되지 않는다.
- 관계형 데이터베이스 설계의 원칙
    - 3차 정규형
        - 장점 : 무손실 조인 분해, 종속성 보존
        - 단점 : 데이터 중복으로 인한 이상 현상
    - 보이스-코드 정규형
        - 장점 : 이상 현상 방지
        - 단점 : 종속성 보존이 안됨
    - 통상적으로는 종속성을 보존하는 방향으로 데이터베이스를 설계한다.
    - 함수적 종속성 보존이 가능하다면 보이스-코드 정규형 선택
    - 함수적 종속성 보존되지 않는다면 3차 정규형 선택
- 정규형을 감안한 논리적 설계 과정
    - ER 스키마를 테이블 스키마로 변환 → 변환된 각 테이블에서 함수적 종속을 정의 → 각 테이블이 보이스-코드 정규형인지를 검증하고 → 아니라면 보이스-코드 정규형으로 분해 → 분해 결과 함수적 종속성이 보존되지 않는다면 제3정규형으로만 분해
- 추가 설명
    - 검색 연산 시, 미리 조인을 해놓는다. (조인 비용이 높기 때문)
        - ***denormalization 역 정규화***